<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="HandheldFriendly" content="true">
    <meta name="Author" content="wutdidusay" />
    <meta name="Keywords" content="오점뭐, 오늘 점심 뭐 먹지, 점심메뉴 고르기, 점심메뉴 추천, 메뉴추천" />
    <meta name="Description" content="점심 메뉴는 왜 이렇게 고르기 어려운것인가" />
    <meta name="robots" content="ALL" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="오늘 점심 뭐 먹지" />
    <meta property="og:site_name" content="오늘 점심 뭐 먹지"> 
    <meta property="og:description" content="점심 메뉴는 왜 이렇게 고르기 어려운것인가" />
    <meta property="og:url" content="https://wutdidusay.github.io/life" />
    <meta property="og:image" content="img/meta-img.png" />
    <meta property=”twitter:card” content="summary"/>
    <meta property=”twitter:title” content="오늘 점심 뭐 먹지"/>
    <meta property=”twitter:description” content="점심 메뉴는 왜 이렇게 고르기 어려운것인가"/>
    <meta name="twitter:url" content="https://wutdidusay.github.io/life">
    <meta property=”twitter:image” content="img/meta-img.png">
    <link rel="apple-touch-icon" href="img/apple-icon.png">
    <link rel="apple-touch-icon-precomposed" href="img/apple-icon.png" />
    <link rel="icon" href="img/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" />
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css">
    <title>주변에서 먹자</title>
    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/party-js@latest/bundle/party.min.js"></script>
    <script src="common.js"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=6d35e2c51ca4cd72d72c9d68d7f044ad&libraries=services"></script>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=64xneazn5f"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JX9E6TSS0S"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-JX9E6TSS0S');
    </script>
</head>

<body class="map-api" ontouchstart="">
    <div class="dim"></div>
    <nav>
        <span class="mark"></span>
        <ul>
            <li><a href="index.html">랜덤메뉴</a></li>
            <li><a href="map-api.html">공사중</a></li>
            <li><a href="eat-this.html">이거 먹어</a></li>
            <li><a href="drink.html">술 마셔</a></li>
            <li><a href="lotto.html">으른의 맛</a></li>
        </ul>
    </nav>

    <h1>내 주변 음식점</h1>
    <p class="notice-text">지도 api 기반 점심메뉴 고르기 업데이트 예정</p>
    <div id="map" style="height:calc(100% - 120px);" class="map-wrap"></div>
    <div class="result-wrap">
        <button type="button" class="result">돌려돌려<br/>메뉴판</button>
        <button type="button" class="to-top"><i class="fas fa-arrow-alt-circle-up"></i></button>
    </div>
    <script>
        // var map = new naver.maps.Map('map', {
        //     center: new naver.maps.LatLng(37.3595704, 127.105399),
        //     logoControl: false,
        //     scaleControl: false,
        //     mapDataControl: false,
        //     zoom: 17
        // });

        var curLocation = '';

        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                center: new kakao.maps.LatLng(37.566826, 126.9786567), // 지도의 중심좌표
                level: 3 // 지도의 확대 레벨
            };

        // 지도를 생성합니다    
        var map = new kakao.maps.Map(mapContainer, mapOption);

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(pos) {
                // curLocation = new naver.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
                // map.setCenter(curLocation)
                curLocation = new kakao.maps.LatLng(pos.coords.latitude, pos.coords.longitude);

                // var ps = new kakao.maps.services.Places(); 
                // ps.keywordSearch('음식점', placesSearchCB);

                // var marker = new naver.maps.Marker({
                //     map: map,
                //     position: curLocation,
                //     icon: {
                //         url: 'https://wutdidusay.github.io/life/img/here.png'
                //     }
                // });

                // 장소 검색 객체를 생성합니다
                var ps = new kakao.maps.services.Places();
                // 키워드로 장소를 검색합니다
                ps.keywordSearch('음식점', placesSearchCB); 
            });
        } else alert("어디 계신지 모르게써요")

        // 키워드 검색 완료 시 호출되는 콜백함수 입니다
        function placesSearchCB (data, status, pagination) {
            if (status === kakao.maps.services.Status.OK) {
                
                // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
                // LatLngBounds 객체에 좌표를 추가합니다
                var bounds = curLocation;

                for (var i=0; i<data.length; i++) {
                    displayMarker(data[i]);    
                    bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
                }       

                // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
                map.setBounds(bounds);
            } 
        }

        // 지도에 마커를 표시하는 함수입니다
        function displayMarker(place) {

            // 마커를 클릭하면 장소명을 표출할 인포윈도우 입니다
            var infowindow = new kakao.maps.InfoWindow({zIndex:1});
            map.setCenter(curLocation);
            
            // 마커를 생성하고 지도에 표시합니다
            var marker = new kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(place.y, place.x) 
            });

            // 마커에 클릭이벤트를 등록합니다
            kakao.maps.event.addListener(marker, 'click', function() {
                // 마커를 클릭하면 장소명이 인포윈도우에 표출됩니다
                infowindow.setContent('<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>');
                infowindow.open(map, marker);
            });
        }

        $('.result').click(function(){
        });
    </script>
</body>

</html>